---
/**
 * Integration type taxonomy page.
 *
 * Shows all integrations of this type (e.g., Artifact Store, Orchestrator).
 * Generates /integration-type/<slug> for each integration type.
 */
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Badge from "../../components/Badge.astro";

export async function getStaticPaths() {
  const integrationTypes = await getCollection("integration-types");
  return integrationTypes.map((itype) => ({
    params: { slug: itype.data.slug },
    props: { integrationType: itype },
  }));
}

const { integrationType } = Astro.props;

// Get all published integrations of this type
const allIntegrations = (
  await getCollection("integrations", ({ data }) => !data.draft && data.integrationType === integrationType.data.slug)
).sort((a, b) => a.data.title.localeCompare(b.data.title));
---

<BaseLayout
  title={`${integrationType.data.name} Integrations - ZenML`}
  description={`ZenML integrations in the ${integrationType.data.name} category.`}
>
  <div class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
    <header class="mb-12">
      <h1 class="text-4xl font-bold tracking-tight text-gray-900">
        {integrationType.data.name}
      </h1>
      <p class="mt-4 text-lg text-gray-600">
        {allIntegrations.length} {allIntegrations.length === 1 ? "integration" : "integrations"} in this category
      </p>
      <a href="/integrations" class="mt-2 inline-block text-sm text-primary-600 hover:text-primary-700">
        &larr; Back to all integrations
      </a>
    </header>

    {/* Integration grid */}
    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {allIntegrations.map((integration) => (
        <a
          href={`/integrations/${integration.data.slug}`}
          class="group flex items-start gap-4 rounded-lg border border-gray-200 bg-white p-5 transition-shadow hover:shadow-md"
        >
          {integration.data.logo && (
            <img
              src={integration.data.logo.url}
              alt={integration.data.logo.alt || integration.data.title}
              class="h-12 w-12 shrink-0 rounded-lg object-contain"
            />
          )}
          <div class="flex-1">
            <h2 class="text-lg font-semibold text-gray-900 group-hover:text-primary-600">
              {integration.data.title}
            </h2>
            {integration.data.shortDescription && (
              <p class="mt-1 line-clamp-2 text-sm text-gray-600">{integration.data.shortDescription}</p>
            )}
            <Badge variant="primary" class="mt-3">
              {integrationType.data.name}
            </Badge>
          </div>
        </a>
      ))}
    </div>

    {allIntegrations.length === 0 && (
      <p class="text-center text-gray-500">No integrations of this type yet.</p>
    )}
  </div>
</BaseLayout>
