---
/**
 * Project detail page.
 *
 * Renders individual project pages with description, tags, tools, and links.
 * Generates /projects/<slug> for each published project.
 */
import { getCollection, render } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Badge from "../../components/Badge.astro";

export async function getStaticPaths() {
  const projects = await getCollection("projects", ({ data }) => !data.draft);
  return projects.map((project) => ({
    params: { slug: project.data.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
const { Content } = await render(project);

// SEO
const seoTitle = project.data.seo?.title || `${project.data.title} - ZenML Projects`;
const seoDescription = project.data.seo?.description || project.data.description;
---

<BaseLayout
  title={seoTitle}
  description={seoDescription}
>
  <div class="mx-auto max-w-4xl px-4 py-12 sm:px-6 lg:px-8">
    {/* Back link */}
    <a href="/projects" class="mb-8 inline-block text-sm text-primary-600 hover:text-primary-700">
      &larr; Back to projects
    </a>

    {/* Main image */}
    {project.data.mainImageLink && (
      <div class="mb-8 overflow-hidden rounded-xl">
        <img
          src={project.data.mainImageLink}
          alt={project.data.title}
          class="w-full object-cover"
        />
      </div>
    )}

    <h1 class="text-3xl font-bold tracking-tight text-gray-900">{project.data.title}</h1>
    {project.data.description && (
      <p class="mt-3 text-lg text-gray-600">{project.data.description}</p>
    )}

    {/* Links */}
    <div class="mt-4 flex gap-4">
      {project.data.githubUrl && (
        <a
          href={project.data.githubUrl}
          class="inline-flex items-center gap-1.5 rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50"
          target="_blank"
          rel="noopener noreferrer"
        >
          View on GitHub &rarr;
        </a>
      )}
      {project.data.demoUrl && (
        <a
          href={project.data.demoUrl}
          class="inline-flex items-center gap-1.5 rounded-lg bg-primary-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-primary-700"
          target="_blank"
          rel="noopener noreferrer"
        >
          Live Demo &rarr;
        </a>
      )}
    </div>

    {/* Tags */}
    {project.data.tags.length > 0 && (
      <div class="mt-6 flex flex-wrap gap-2">
        {project.data.tags.map((tag: string) => (
          <Badge variant="blue">{tag}</Badge>
        ))}
      </div>
    )}

    {/* Tools */}
    {project.data.tools.length > 0 && (
      <div class="mt-4">
        <span class="text-sm font-medium text-gray-500">Tools: </span>
        <span class="text-sm text-gray-700">{project.data.tools.join(", ")}</span>
      </div>
    )}

    {/* Body content */}
    <div class="prose prose-gray mt-8 max-w-none">
      <Content />
    </div>
  </div>
</BaseLayout>
