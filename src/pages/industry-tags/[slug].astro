---
/**
 * Industry tag taxonomy page.
 *
 * Shows all LLMOps database entries in this industry.
 * Generates /industry-tags/<slug> for each industry tag in the collection.
 */
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Badge from "../../components/Badge.astro";

export async function getStaticPaths() {
  const industryTags = await getCollection("industry-tags");
  return industryTags.map((tag) => ({
    params: { slug: tag.data.slug },
    props: { tag },
  }));
}

const { tag } = Astro.props;

// Get all published LLMOps entries with this industry tag
// industryTags is a single string slug (not an array)
const allEntries = (
  await getCollection("llmops-database", ({ data }) => !data.draft && data.industryTags === tag.data.slug)
).sort((a, b) => a.data.title.localeCompare(b.data.title));
---

<BaseLayout
  title={`${tag.data.name} Industry - LLMOps Database`}
  description={`LLMOps tools and platforms in the ${tag.data.name} industry.`}
>
  <div class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
    <header class="mb-12">
      <h1 class="text-4xl font-bold tracking-tight text-gray-900">
        Industry: {tag.data.name}
      </h1>
      <p class="mt-4 text-lg text-gray-600">
        {allEntries.length} {allEntries.length === 1 ? "tool" : "tools"} in this industry
      </p>
      <a href="/llmops-database" class="mt-2 inline-block text-sm text-primary-600 hover:text-primary-700">
        &larr; Back to LLMOps Database
      </a>
    </header>

    {/* Entry grid */}
    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {allEntries.map((entry) => (
        <a
          href={`/llmops-database/${entry.data.slug}`}
          class="group flex flex-col rounded-lg border border-gray-200 bg-white p-5 transition-shadow hover:shadow-md"
        >
          <h2 class="text-lg font-semibold text-gray-900 group-hover:text-primary-600">
            {entry.data.title}
          </h2>
          {entry.data.company && (
            <p class="mt-1 text-sm text-gray-500">{entry.data.company}</p>
          )}
          {entry.data.summary && (
            <p class="mt-2 line-clamp-3 text-sm text-gray-600">{entry.data.summary}</p>
          )}
          <div class="mt-auto flex flex-wrap gap-1.5 pt-4">
            {entry.data.llmopsTags.slice(0, 4).map((tagSlug: string) => (
              <Badge variant="blue">{tagSlug}</Badge>
            ))}
            {entry.data.llmopsTags.length > 4 && (
              <Badge variant="gray">+{entry.data.llmopsTags.length - 4}</Badge>
            )}
          </div>
        </a>
      ))}
    </div>

    {allEntries.length === 0 && (
      <p class="text-center text-gray-500">No LLMOps entries in this industry yet.</p>
    )}
  </div>
</BaseLayout>
