---
/**
 * Industry tags index page.
 *
 * Lists all industries with entry counts, sorted by popularity.
 * Route: /industry-tags
 */
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getAllPublishedEntries, getIndustryTagCounts } from "../../lib/llmops";
import type { TaxonomyCount } from "../../lib/llmops";

const entries = await getAllPublishedEntries();
const usedCounts = await getIndustryTagCounts(entries);
const usedMap = new Map(usedCounts.map((t) => [t.slug, t.count]));

// Merge all taxonomy terms with used counts (include zero-count industries)
const allIndustries = await getCollection("industry-tags");
const industries: TaxonomyCount[] = allIndustries
  .map((t) => ({
    slug: t.data.slug,
    name: t.data.name,
    count: usedMap.get(t.data.slug) ?? 0,
  }))
  .sort((a, b) => b.count - a.count || a.name.localeCompare(b.name));
---

<BaseLayout
  title="Industries - ZenML LLMOps Database"
  description="Browse all industries represented in the ZenML LLMOps Database."
>
  <div class="mx-auto max-w-4xl px-4 py-12 sm:px-6 lg:px-8">
    <header class="mb-10">
      <h1 class="text-4xl font-bold tracking-tight text-gray-900">Industries</h1>
      <p class="mt-3 text-lg text-gray-600">
        {industries.length} {industries.length === 1 ? "industry" : "industries"} in the database
      </p>
      <a href="/llmops-database" class="mt-2 inline-block text-sm text-primary-600 hover:text-primary-700">
        &larr; Back to LLMOps Database
      </a>
    </header>

    <nav aria-label="All industries">
      <ul class="divide-y divide-gray-200 rounded-lg border border-gray-200 bg-white">
        {industries.map((t) => (
          <li>
            <a
              href={`/industry-tags/${t.slug}`}
              class="flex items-center justify-between px-4 py-3 text-sm hover:bg-gray-50"
            >
              <span class="font-medium text-gray-900">{t.name}</span>
              <span class="text-xs tabular-nums text-gray-400">{t.count}</span>
            </a>
          </li>
        ))}
      </ul>
    </nav>
  </div>
</BaseLayout>
