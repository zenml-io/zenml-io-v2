---
import Button from "../components/Button.astro";
/**
 * Deployments page.
 *
 * Route: /deployments
 *
 * Deployment options overview: hero, architecture diagram + feature cards,
 * OSS vs Pro comparison table, 3 deployment scenario layouts, deployment
 * methods grid, tabbed architecture diagrams, and final CTA.
 */
import BaseLayout from "../layouts/BaseLayout.astro";
import {
  DEPLOYMENTS_ARCHITECTURE,
  DEPLOYMENTS_COMPARISON,
  DEPLOYMENTS_FINAL_CTA,
  DEPLOYMENTS_HERO,
  DEPLOYMENTS_METHODS,
  DEPLOYMENTS_SCENARIOS,
  DEPLOYMENTS_SEO,
  DEPLOYMENTS_TABS,
} from "../lib/deployments";
---

<BaseLayout
  title={DEPLOYMENTS_SEO.title}
  description={DEPLOYMENTS_SEO.description}
  ogTitle={DEPLOYMENTS_SEO.ogTitle}
  ogDescription={DEPLOYMENTS_SEO.ogDescription}
  ogImage={DEPLOYMENTS_SEO.ogImage}
>
  <script is:inline>
    (() => {
      const root = document.documentElement;
      root.classList.add("deployments-tabs-enabled");
      if (!window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
        root.classList.add("reveal-enabled");
      }
    })();
  </script>
  <main data-page="deployments" data-reveal-scope="deployments">
    {/* Hero */}
    <section class="bg-white pt-16 pb-12 sm:pt-24 sm:pb-16">
      <div class="mx-auto max-w-4xl px-4 text-center sm:px-6 lg:px-8" data-reveal>
        <h1 class="text-3xl font-bold text-gray-900 sm:text-4xl lg:text-5xl">
          {DEPLOYMENTS_HERO.headline}
        </h1>
        <p class="mt-4 text-lg text-gray-600 leading-relaxed">
          {DEPLOYMENTS_HERO.deck}
        </p>
        <div class="mt-8 flex flex-col items-center gap-3 sm:flex-row sm:justify-center">
          <Button href={DEPLOYMENTS_HERO.primaryCta.href} variant="secondary" size="lg">
            {DEPLOYMENTS_HERO.primaryCta.label}
          </Button>
          <Button
            href={DEPLOYMENTS_HERO.secondaryCta.href}
            size="lg"
            target="_blank"
            rel="noopener noreferrer"
          >
            {DEPLOYMENTS_HERO.secondaryCta.label}
          </Button>
        </div>
      </div>
    </section>

    {/* Architecture overview (dark) */}
    <section class="deployments-dark-rail py-24 sm:py-28">
      <div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
        <div class="mx-auto max-w-3xl text-center" data-reveal>
          <p class="text-sm font-semibold uppercase tracking-wider text-zenml-400">
            {DEPLOYMENTS_ARCHITECTURE.eyebrow}
          </p>
          <h2 class="mt-2 text-2xl font-bold text-white sm:text-3xl">
            {DEPLOYMENTS_ARCHITECTURE.headline}
          </h2>
          <p class="mt-3 text-lg text-gray-300">
            {DEPLOYMENTS_ARCHITECTURE.body}
          </p>
        </div>
        <div class="mt-8" data-reveal style="transition-delay: 80ms;">
          <img
            src={DEPLOYMENTS_ARCHITECTURE.image.url}
            alt={DEPLOYMENTS_ARCHITECTURE.image.alt}
            class="mx-auto w-full max-w-[900px]"
            loading="lazy"
          />
        </div>
        <div class="deployments-arch-cards mt-16 grid gap-8 sm:grid-cols-3" data-reveal style="transition-delay: 160ms;">
          {DEPLOYMENTS_ARCHITECTURE.features.map((feat) => (
            <div class="deployments-arch-card">
              <p class="text-sm font-semibold uppercase tracking-wider text-orange-400">
                {feat.eyebrow}
              </p>
              <h3 class="mt-2 text-lg font-semibold text-white">{feat.title}</h3>
              <p class="mt-2 text-sm text-gray-300">{feat.body}</p>
            </div>
          ))}
        </div>
      </div>
    </section>

    {/* Comparison table (dark) */}
    <section class="deployments-comparison-section pb-24 sm:pb-28">
      <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl" data-reveal>
          <p class="text-sm font-semibold uppercase tracking-wider text-zenml-400">
            {DEPLOYMENTS_COMPARISON.eyebrow}
          </p>
          <h2 class="mt-2 text-2xl font-bold text-white sm:text-3xl">
            {DEPLOYMENTS_COMPARISON.headline}
          </h2>
        </div>
        <div class="mt-8 overflow-x-auto" data-reveal>
          <table class="w-full min-w-[640px] deployments-comparison-table text-sm">
            <colgroup>
              <col style="width: 50%;" />
              <col style="width: 25%;" />
              <col style="width: 25%;" />
            </colgroup>
            <thead>
              <tr class="deployments-comparison-row-header-copy two-options">
                <th class="table-feature-heading">Feature</th>
                {DEPLOYMENTS_COMPARISON.columnHeaders.map((header) => (
                  <th class="table-col-heading">{header}</th>
                ))}
              </tr>
            </thead>
            <tbody>
              {DEPLOYMENTS_COMPARISON.rows.map((row, i) => (
                <tr class:list={[
                  "deployments-comparison-row_two-options",
                  i % 2 === 0 && "lighter",
                ]}>
                  <td class="table-feature">{row.feature}</td>
                  {row.values.map((val, colIndex) => (
                    <td class="table-value">
                      {val === true ? (
                        <svg
                          class:list={[
                            "mx-auto h-5 w-5",
                            colIndex === 1 || row.values[1] === false ? "text-orange-400" : "text-white",
                          ]}
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                          stroke-width="2"
                        >
                          <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 12l3 3 6-6m5.5 3a10 10 0 1 1-20 0 10 10 0 0 1 20 0z" />
                        </svg>
                      ) : val === false ? (
                        <svg class="mx-auto h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="#98A2B3" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" />
                        </svg>
                      ) : (
                        <span class="deployments-comparison-text">{val}</span>
                      )}
                    </td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </section>

    {/* Deployment scenarios (alternating layouts) */}
    <section class="bg-white py-16 sm:py-20">
      <div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 space-y-16">
        {DEPLOYMENTS_SCENARIOS.map((scenario, i) => (
          <div class:list={[
            "grid items-center gap-10 lg:grid-cols-2",
            i % 2 === 1 && "lg:[direction:rtl] lg:[&>*]:[direction:ltr]",
          ]} data-reveal>
            <div>
              <h2 class="text-2xl font-bold text-gray-900 sm:text-3xl">
                {scenario.title}
              </h2>
              <ul class="mt-4 space-y-2">
                {scenario.bullets.map((bullet) => (
                  <li class="flex items-start gap-2 text-gray-600">
                    <svg class="mt-0.5 h-5 w-5 flex-shrink-0 text-zenml-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4" />
                    </svg>
                    {bullet}
                  </li>
                ))}
              </ul>
              <a
                href={scenario.learnMoreHref}
                target={scenario.learnMoreHref.startsWith("http") ? "_blank" : undefined}
                rel={scenario.learnMoreHref.startsWith("http") ? "noopener noreferrer" : undefined}
                class="mt-4 inline-flex items-center gap-1 text-sm font-semibold text-zenml-500 hover:text-zenml-600"
              >
                Learn More
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5-5 5M6 12h12" />
                </svg>
              </a>
            </div>
            <img
              src={scenario.image.url}
              alt={scenario.image.alt}
              class="w-full rounded-xl"
              loading="lazy"
            />
          </div>
        ))}
      </div>
    </section>

    {/* Deployment methods grid */}
    <section class="bg-gray-50 py-12">
      <div class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8">
        <p class="text-gray-600">Various methods available:</p>
        <div class="mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-4" data-reveal>
          {DEPLOYMENTS_METHODS.map((method) => (
            <a
              href={method.href}
              target="_blank"
              rel="noopener noreferrer"
              class="flex items-center gap-4 rounded-xl border border-gray-200 bg-white p-4 transition hover:shadow-md"
            >
              <img
                src={method.icon}
                alt={method.iconAlt}
                class="h-12 w-12 flex-shrink-0 object-contain"
                loading="lazy"
              />
              <div>
                <h3 class="font-semibold text-gray-900">{method.title}</h3>
                <p class="mt-1 text-xs text-gray-500">{method.body}</p>
              </div>
            </a>
          ))}
        </div>
      </div>
    </section>

    {/* Tabbed architecture diagrams */}
    <section class="bg-white py-16 sm:py-20">
      <div class="mx-auto max-w-5xl px-4 text-center sm:px-6 lg:px-8">
        <div data-reveal>
          <p class="text-sm font-semibold uppercase tracking-wider text-zenml-500">
            {DEPLOYMENTS_TABS.eyebrow}
          </p>
          <h2 class="mt-2 text-2xl font-bold text-gray-900 sm:text-3xl">
            {DEPLOYMENTS_TABS.headline}
          </h2>
          <p class="mt-3 text-lg text-gray-600">{DEPLOYMENTS_TABS.body}</p>
        </div>

        <div class="deployments-tabs" data-deployments-tabs data-reveal>
          <div class="deployments-tabs-menu" role="tablist" aria-label="Deployment architectures">
            {DEPLOYMENTS_TABS.tabs.map((tab, i) => (
              <a
                href={`#deploy-panel-${i}`}
                role="tab"
                aria-selected={i === 0 ? "true" : "false"}
                aria-controls={`deploy-panel-${i}`}
                data-deploy-tab-id={`deploy-panel-${i}`}
                class:list={["deployments-tab", i === 0 && "w--current"]}
              >
                <div class="flex items-center gap-2">
                  <div class="text-base font-semibold text-gray-900">{tab.label}</div>
                  <span class:list={[
                    "rounded-full px-2 py-0.5 text-xs font-bold",
                    tab.badgeVariant === "pro"
                      ? "bg-orange-100 text-orange-600"
                      : "bg-zenml-50 text-zenml-500",
                  ]}>
                    {tab.badge}
                  </span>
                </div>
                <div class="deployment-description">{tab.description}</div>
              </a>
            ))}
          </div>

          <div class="tabs-content">
            {DEPLOYMENTS_TABS.tabs.map((tab, i) => (
              <div
                id={`deploy-panel-${i}`}
                role="tabpanel"
                data-deploy-panel
                class:list={["deployments-tab-pane", i === 0 && "is-active"]}
              >
                <img
                  src={tab.image.url}
                  alt={tab.image.alt}
                  class="deployment-image"
                  loading="lazy"
                />
              </div>
            ))}
          </div>
        </div>

        {/* Feature grid */}
        <div class="mt-12 grid gap-6 text-left sm:grid-cols-2 lg:grid-cols-3" data-reveal>
          {DEPLOYMENTS_TABS.features.map((feat) => (
            <div>
              <h3 class="font-semibold text-gray-900">{feat.title}</h3>
              <p class="mt-1 text-sm text-gray-600">{feat.body}</p>
            </div>
          ))}
        </div>
      </div>
    </section>

    {/* Final CTA (dark) */}
    <section class="deployments-final-cta-section py-20 sm:py-24">
      <div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
        <div class="deployments-final-cta-component" data-reveal>
          <div>
            <h2 class="text-2xl font-bold text-white sm:text-3xl">
              {DEPLOYMENTS_FINAL_CTA.headline}
            </h2>
            <ul class="deployments-final-cta-item-list">
              {DEPLOYMENTS_FINAL_CTA.bullets.map((bullet) => (
                <li class="deployments-final-cta-item">
                  <svg class="deployments-final-cta-item-icon" fill="none" viewBox="0 0 28 28" stroke="currentColor" stroke-width="2">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M8.75 14l3.5 3.5 7-7M25.666 14c0 6.443-5.223 11.666-11.666 11.666S2.334 20.443 2.334 14 7.557 2.334 14 2.334 25.666 7.557 25.666 14z"
                    ></path>
                  </svg>
                  <span>{bullet}</span>
                </li>
              ))}
            </ul>
            <div class="deployments-final-cta-button-row">
              <Button href={DEPLOYMENTS_FINAL_CTA.primaryCta.href} variant="primary" size="lg">
                {DEPLOYMENTS_FINAL_CTA.primaryCta.label}
              </Button>
              <Button href={DEPLOYMENTS_FINAL_CTA.secondaryCta.href} variant="secondaryGray" size="lg">
                {DEPLOYMENTS_FINAL_CTA.secondaryCta.label}
              </Button>
            </div>
          </div>
          <img
            src={DEPLOYMENTS_FINAL_CTA.image.url}
            alt={DEPLOYMENTS_FINAL_CTA.image.alt}
            class="deployments-final-cta-image"
            loading="lazy"
          />
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<style is:global>
  [data-page="deployments"] .deployments-dark-rail,
  [data-page="deployments"] .deployments-comparison-section {
    background-color: var(--color-zenml-700);
  }

  [data-page="deployments"] .deployments-arch-cards {
    margin-bottom: 4rem;
  }

  [data-page="deployments"] .deployments-arch-card {
    text-align: left;
    background-color: var(--color-zenml-600);
    flex-direction: column;
    justify-content: space-between;
    align-items: flex-start;
    width: 100%;
    padding: 1.5rem;
    display: flex;
  }

  [data-page="deployments"] .deployments-comparison-table {
    border-collapse: separate;
    border-spacing: 0;
  }

  [data-page="deployments"] .deployments-comparison-row-header-copy.two-options .table-feature-heading,
  [data-page="deployments"] .deployments-comparison-row-header-copy.two-options .table-col-heading {
    padding: 1rem;
    border-bottom: 0;
    color: #fff;
    font-size: 0.875rem;
    font-weight: 700;
  }

  [data-page="deployments"] .deployments-comparison-row-header-copy.two-options .table-feature-heading {
    text-align: left;
  }

  [data-page="deployments"] .deployments-comparison-row-header-copy.two-options .table-col-heading {
    text-align: center;
  }

  [data-page="deployments"] .deployments-comparison-row_two-options .table-feature,
  [data-page="deployments"] .deployments-comparison-row_two-options .table-value {
    padding: 1rem;
    border-bottom: 0;
    background-color: var(--color-zenml-700);
  }

  [data-page="deployments"] .deployments-comparison-row_two-options.lighter .table-feature,
  [data-page="deployments"] .deployments-comparison-row_two-options.lighter .table-value {
    background-color: var(--color-zenml-600);
  }

  [data-page="deployments"] .deployments-comparison-row_two-options .table-feature {
    color: #fff;
    font-weight: 500;
    text-align: left;
  }

  [data-page="deployments"] .deployments-comparison-row_two-options .table-value {
    text-align: center;
  }

  [data-page="deployments"] .deployments-comparison-text {
    color: #fff;
  }

  [data-page="deployments"] .deployments-tabs {
    display: flex;
    gap: 16px;
    justify-content: center;
    align-items: flex-start;
    width: 100%;
    margin-top: 2rem;
  }

  [data-page="deployments"] .deployments-tabs-menu {
    display: flex;
    flex-flow: column;
    justify-content: center;
    align-items: flex-start;
    width: 20%;
    min-width: 12rem;
    gap: 1rem;
    margin-bottom: 1rem;
    padding-top: 1rem;
  }

  [data-page="deployments"] .deployments-tab {
    width: 100%;
    border-bottom: 1px solid var(--color-gray-500);
    background-color: transparent;
    overflow: hidden;
    text-decoration: none;
    text-align: left;
    padding-bottom: 0.5rem;
  }

  .deployments-tabs-enabled [data-page="deployments"] .deployments-tab {
    opacity: 0.2;
  }

  [data-page="deployments"] .deployments-tab.w--current {
    border-bottom-width: 2px;
    border-color: var(--color-zenml-500);
    opacity: 1;
    transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
  }

  [data-page="deployments"] .deployment-description {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
    font-size: 0.75rem;
    line-height: 1.5;
    color: var(--color-gray-700);
  }

  .deployments-tabs-enabled [data-page="deployments"] .deployment-description {
    max-height: 0;
    margin-top: 0;
    margin-bottom: 0;
    opacity: 0;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.215, 0.61, 0.355, 1);
  }

  .deployments-tabs-enabled [data-page="deployments"] .deployments-tab.w--current .deployment-description {
    max-height: 12rem;
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
    opacity: 1;
  }

  [data-page="deployments"] .tabs-content {
    flex: 1;
    justify-content: center;
    align-items: flex-start;
    display: flex;
  }

  [data-page="deployments"] .deployments-tab-pane {
    width: 100%;
    text-align: center;
  }

  .deployments-tabs-enabled [data-page="deployments"] .deployments-tab-pane {
    display: none;
  }

  .deployments-tabs-enabled [data-page="deployments"] .deployments-tab-pane.is-active {
    display: block;
  }

  [data-page="deployments"] .deployment-image {
    border: 1px solid var(--color-gray-300);
    border-radius: var(--radius-md);
    background-color: #fff;
    width: 100%;
    max-width: 680px;
    padding: 1rem;
  }

  [data-page="deployments"] .deployments-final-cta-section {
    background-color: var(--color-zenml-700);
    background-image: radial-gradient(circle at 80% 20%, rgba(122, 62, 244, 0.4) 0%, rgba(122, 62, 244, 0) 38%),
      linear-gradient(180deg, var(--color-zenml-700) 0%, var(--color-zenml-800) 100%);
    overflow: hidden;
  }

  [data-page="deployments"] .deployments-final-cta-component {
    display: grid;
    grid-template-columns: 1fr 1fr;
    align-items: center;
    gap: 2rem 4rem;
  }

  [data-page="deployments"] .deployments-final-cta-item-list {
    display: grid;
    gap: 1rem;
    margin-top: 2rem;
    margin-bottom: 2.5rem;
  }

  [data-page="deployments"] .deployments-final-cta-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    font-size: 1.125rem;
    line-height: 1.6;
    color: #fff;
  }

  [data-page="deployments"] .deployments-final-cta-item-icon {
    width: 1.75rem;
    height: 1.75rem;
    flex-shrink: 0;
    color: var(--color-zenml-500);
    margin-top: 0.1rem;
  }

  [data-page="deployments"] .deployments-final-cta-button-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    align-items: center;
  }

  [data-page="deployments"] .deployments-final-cta-image {
    width: 100%;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-large);
  }

  [data-page="deployments"] [data-reveal] {
    opacity: 1;
    transform: none;
  }

  .reveal-enabled [data-page="deployments"] [data-reveal] {
    opacity: 0;
    transform: translateY(16px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .reveal-enabled [data-page="deployments"] [data-reveal].in-view {
    opacity: 1;
    transform: translateY(0);
  }

  @media (max-width: 1023px) {
    [data-page="deployments"] .deployments-tabs {
      flex-direction: column;
    }

    [data-page="deployments"] .deployments-tabs-menu {
      width: 100%;
      min-width: 0;
    }

    [data-page="deployments"] .tabs-content {
      width: 100%;
    }

    [data-page="deployments"] .deployments-final-cta-component {
      grid-template-columns: 1fr;
      gap: 2rem;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .reveal-enabled [data-page="deployments"] [data-reveal] {
      opacity: 1;
      transform: none;
      transition: none;
    }

    .deployments-tabs-enabled [data-page="deployments"] .deployment-description {
      transition: none;
    }
  }
</style>

<script>
  (() => {
    const page = document.querySelector('[data-page="deployments"]');
    if (!page) return;

    const tabsRoot = page.querySelector("[data-deployments-tabs]");
    if (tabsRoot && tabsRoot.dataset.initialized !== "true") {
      tabsRoot.dataset.initialized = "true";
      const tabs = Array.from(tabsRoot.querySelectorAll(".deployments-tab"));
      const panels = Array.from(tabsRoot.querySelectorAll("[data-deploy-panel]"));
      const validPanelIds = new Set(panels.map((panel) => panel.id));

      const resolvePanelId = (candidateId) => {
        if (candidateId && validPanelIds.has(candidateId)) return candidateId;
        return panels[0]?.id ?? null;
      };

      const setActivePanel = (panelId, updateHash = true) => {
        if (!panelId) return;
        tabs.forEach((tab) => {
          const isActive = tab.dataset.deployTabId === panelId;
          tab.classList.toggle("w--current", isActive);
          tab.setAttribute("aria-selected", String(isActive));
          tab.setAttribute("tabindex", isActive ? "0" : "-1");
        });
        panels.forEach((panel) => {
          panel.classList.toggle("is-active", panel.id === panelId);
        });
        if (updateHash) history.replaceState(null, "", `#${panelId}`);
      };

      const activateByIndex = (index) => {
        const tab = tabs[index];
        if (!tab) return;
        const panelId = resolvePanelId(tab.dataset.deployTabId);
        if (!panelId) return;
        tab.focus();
        setActivePanel(panelId);
      };

      tabs.forEach((tab, index) => {
        tab.addEventListener("click", (event) => {
          event.preventDefault();
          const panelId = resolvePanelId(tab.dataset.deployTabId);
          setActivePanel(panelId);
        });

        tab.addEventListener("keydown", (event) => {
          if (event.key === "ArrowDown" || event.key === "ArrowRight") {
            event.preventDefault();
            activateByIndex((index + 1) % tabs.length);
          } else if (event.key === "ArrowUp" || event.key === "ArrowLeft") {
            event.preventDefault();
            activateByIndex((index - 1 + tabs.length) % tabs.length);
          } else if (event.key === "Home") {
            event.preventDefault();
            activateByIndex(0);
          } else if (event.key === "End") {
            event.preventDefault();
            activateByIndex(tabs.length - 1);
          } else if (event.key === "Enter" || event.key === " ") {
            event.preventDefault();
            const panelId = resolvePanelId(tab.dataset.deployTabId);
            setActivePanel(panelId);
          }
        });
      });

      const activateFromHash = () => {
        const hashPanelId = resolvePanelId(window.location.hash.replace("#", ""));
        setActivePanel(hashPanelId, false);
      };

      window.addEventListener("hashchange", activateFromHash);
      activateFromHash();
    }

    if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) return;

    const revealScope = page.querySelector('[data-reveal-scope="deployments"]');
    if (!revealScope || revealScope.dataset.revealInitialized === "true") return;
    revealScope.dataset.revealInitialized = "true";

    const revealElements = revealScope.querySelectorAll("[data-reveal]");
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (!entry.isIntersecting) return;
          entry.target.classList.add("in-view");
          observer.unobserve(entry.target);
        });
      },
      {
        threshold: 0.1,
        rootMargin: "0px 0px -40px 0px",
      }
    );

    revealElements.forEach((element) => observer.observe(element));
  })();
</script>
