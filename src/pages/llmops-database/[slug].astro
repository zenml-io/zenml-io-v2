---
/**
 * LLMOps Database detail page.
 *
 * Renders individual LLMOps entries with company info, tags, summary, and body.
 * Generates /llmops-database/<slug> for each published entry.
 */
import { getCollection, getEntry, render } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Badge from "../../components/Badge.astro";

export async function getStaticPaths() {
  const entries = await getCollection("llmops-database", ({ data }) => !data.draft);
  return entries.map((entry) => ({
    params: { slug: entry.data.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

// Resolve llmops tags for display names
const tagEntries = await Promise.all(
  entry.data.llmopsTags.map((slug: string) => getEntry("llmops-tags", slug))
);
const tags = tagEntries.filter(Boolean).map((t) => ({
  name: t!.data.name,
  slug: t!.data.slug,
}));

// Resolve industry tag
const industryEntry = entry.data.industryTags
  ? await getEntry("industry-tags", entry.data.industryTags)
  : undefined;

// SEO
const seoTitle = entry.data.seo?.title || `${entry.data.title} - ZenML LLMOps Database`;
const seoDescription = entry.data.seo?.description || entry.data.summary;
const ogImage = entry.data.seo?.ogImage;
---

<BaseLayout
  title={seoTitle}
  description={seoDescription}
  ogImage={ogImage}
  ogTitle={entry.data.seo?.ogTitle}
  ogDescription={entry.data.seo?.ogDescription}
  canonical={entry.data.seo?.canonical}
>
  <div class="mx-auto max-w-4xl px-4 py-12 sm:px-6 lg:px-8">
    {/* Breadcrumb */}
    <nav class="mb-8 text-sm text-gray-500">
      <a href="/llmops-database" class="hover:text-primary-600">LLMOps Database</a>
      <span class="mx-2">/</span>
      <span class="text-gray-900">{entry.data.title}</span>
    </nav>

    {/* Header */}
    <header class="mb-8">
      <h1 class="text-3xl font-bold tracking-tight text-gray-900">{entry.data.title}</h1>

      <div class="mt-4 flex flex-wrap items-center gap-3 text-sm text-gray-500">
        {entry.data.company && (
          <span class="font-medium text-gray-700">{entry.data.company}</span>
        )}
        {entry.data.year && (
          <>
            <span aria-hidden="true">&middot;</span>
            <span>{entry.data.year}</span>
          </>
        )}
        {industryEntry && (
          <>
            <span aria-hidden="true">&middot;</span>
            <Badge href={`/industry-tags/${industryEntry.data.slug}`} variant="primary">
              {industryEntry.data.name}
            </Badge>
          </>
        )}
      </div>

      {entry.data.link && (
        <a
          href={entry.data.link}
          class="mt-3 inline-flex items-center gap-1 text-sm font-medium text-primary-600 hover:text-primary-700"
          target="_blank"
          rel="noopener noreferrer"
        >
          View original source &rarr;
        </a>
      )}
    </header>

    {/* Summary */}
    {entry.data.summary && (
      <div class="mb-8 rounded-lg border border-gray-200 bg-gray-50 p-6">
        <p class="text-gray-700">{entry.data.summary}</p>
      </div>
    )}

    {/* Tags */}
    {tags.length > 0 && (
      <div class="mb-8 flex flex-wrap gap-2">
        {tags.map((tag) => (
          <Badge href={`/llmops-tags/${tag.slug}`} variant="blue">
            {tag.name}
          </Badge>
        ))}
      </div>
    )}

    {/* Body content */}
    <div class="prose prose-gray max-w-none">
      <Content />
    </div>
  </div>
</BaseLayout>
