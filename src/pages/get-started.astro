---
/**
 * Get Started page.
 *
 * Route: /get-started
 *
 * Open-source onboarding page: hero, 3-step code walkthrough,
 * architecture diagram, projects showcase, resources grid, and CTA.
 */
import BaseLayout from "../layouts/BaseLayout.astro";
import Button from "../components/Button.astro";
import FeaturesHubCTA from "../components/sections/FeaturesHubCTA.astro";
import { getCollection } from "astro:content";
import { createHighlighter } from "shiki";
import zenmlDark from "../styles/zenml-dark.json";
import {
  GET_STARTED_SEO,
  GET_STARTED_HERO,
  GET_STARTED_STEPS,
  GET_STARTED_ARCHITECTURE,
  GET_STARTED_PROJECTS,
  GET_STARTED_RESOURCES,
  GET_STARTED_FINAL_CTA,
} from "../lib/getStarted";

// Highlight code steps at build time with dark theme
const highlighter = await createHighlighter({
  themes: [zenmlDark as any],
  langs: ["python", "bash"],
});

const highlightedSteps = GET_STARTED_STEPS.items.map((step) => {
  const lang = step.code.includes("\n") ? "python" : "bash";
  const html = highlighter.codeToHtml(step.code, {
    lang,
    theme: "zenml-dark",
  });
  return { ...step, highlightedHtml: html };
});

// Pull projects from the CMS collection if it exists
let projects: { data: { title: string; description?: string; mainImage?: string }; id: string }[] = [];
try {
  const allProjects = await getCollection("projects");
  projects = allProjects
    .slice(0, 6)
    .map((p) => ({
      data: {
        title: (p.data as any).title ?? p.id,
        description: (p.data as any).description,
        mainImage: (p.data as any).mainImage,
      },
      id: p.id,
    }));
} catch {
  // Collection may not exist yet â€” show empty state
}

const resourceColors = {
  teal: "bg-teal-50 text-teal-600",
  blue: "bg-blue-50 text-blue-600",
  purple: "bg-zenml-50 text-zenml-500",
  gray: "bg-gray-100 text-gray-600",
} as const;
---

<BaseLayout
  title={GET_STARTED_SEO.title}
  description={GET_STARTED_SEO.description}
  ogTitle={GET_STARTED_SEO.ogTitle}
  ogDescription={GET_STARTED_SEO.ogDescription}
  ogImage={GET_STARTED_SEO.ogImage}
>
  <main>
    {/* Hero */}
    <section class="bg-linear-to-t from-zenml-50 to-white border-b border-gray-200 pt-16 pb-12 sm:pt-24 sm:pb-16">
      <div class="mx-auto max-w-4xl px-4 text-center sm:px-6 lg:px-8">
        <p class="text-sm font-semibold uppercase tracking-wider text-zenml-500">
          {GET_STARTED_HERO.eyebrow}
        </p>
        <h1 class="mt-2 text-3xl font-bold text-gray-900 sm:text-4xl lg:text-5xl">
          {GET_STARTED_HERO.headline}
        </h1>
        <p class="mt-4 text-lg text-gray-600 leading-relaxed">
          {GET_STARTED_HERO.deck}
        </p>
        <div class="mt-8 flex flex-col items-center gap-3 sm:flex-row sm:justify-center">
          <Button
            href={GET_STARTED_HERO.primaryCta.href}
            variant="secondary"
            size="lg"
            target="_blank"
            rel="noopener noreferrer"
          >
            {GET_STARTED_HERO.primaryCta.label}
          </Button>
          <Button
            href={GET_STARTED_HERO.secondaryCta.href}
            size="lg"
            target="_blank"
            rel="noopener noreferrer"
          >
            {GET_STARTED_HERO.secondaryCta.label}
          </Button>
        </div>
      </div>
    </section>

    {/* Code steps */}
    <section class="bg-gray-900 py-16 sm:py-20">
      <div class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8">
        <h2 class="text-2xl font-bold text-white sm:text-3xl">
          {GET_STARTED_STEPS.headline}
        </h2>
        <div class="mt-10 space-y-10">
          {highlightedSteps.map((step) => (
            <div>
              <h3 class="text-lg font-semibold text-white">{step.title}</h3>
              <p class="mt-1 text-sm text-gray-300" set:html={step.body} />
              <div class="mt-3 dark-code-block" set:html={step.highlightedHtml} />
            </div>
          ))}
        </div>
      </div>
    </section>

    {/* Architecture */}
    <section class="bg-gray-900 py-16 sm:py-20">
      <div class="mx-auto max-w-5xl px-4 text-center sm:px-6 lg:px-8">
        <p class="text-sm font-semibold uppercase tracking-wider text-zenml-400">
          {GET_STARTED_ARCHITECTURE.eyebrow}
        </p>
        <h2 class="mt-2 text-2xl font-bold text-white sm:text-3xl">
          {GET_STARTED_ARCHITECTURE.headline}
        </h2>
        <p class="mt-3 text-lg text-gray-300">
          {GET_STARTED_ARCHITECTURE.body}
        </p>
        <div class="mt-8">
          <img
            src={GET_STARTED_ARCHITECTURE.image.url}
            alt={GET_STARTED_ARCHITECTURE.image.alt}
            class="w-full max-w-[900px] mx-auto"
            loading="lazy"
          />
        </div>
        <div class="mt-8 flex flex-col items-center gap-3 sm:flex-row sm:justify-center">
          <Button href={GET_STARTED_ARCHITECTURE.primaryCta.href} variant="secondary" size="lg">
            {GET_STARTED_ARCHITECTURE.primaryCta.label}
          </Button>
          <Button
            href={GET_STARTED_ARCHITECTURE.secondaryCta.href}
            size="lg"
            target="_blank"
            rel="noopener noreferrer"
          >
            {GET_STARTED_ARCHITECTURE.secondaryCta.label}
          </Button>
        </div>
      </div>
    </section>

    {/* Projects */}
    <section class="bg-white py-16 sm:py-20">
      <div class="mx-auto max-w-5xl px-4 text-center sm:px-6 lg:px-8">
        <p class="text-sm font-semibold uppercase tracking-wider text-zenml-500">
          {GET_STARTED_PROJECTS.eyebrow}
        </p>
        <h2 class="mt-2 text-2xl font-bold text-gray-900 sm:text-3xl">
          {GET_STARTED_PROJECTS.headline}
        </h2>
        <p class="mt-3 text-lg text-gray-600">{GET_STARTED_PROJECTS.deck}</p>
        {projects.length > 0 ? (
          <div class="mt-10 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
            {projects.map((project) => (
              <a
                href={`/projects/${project.id}`}
                class="block rounded-lg border border-gray-200 p-4 text-left hover:shadow-md transition"
              >
                <h3 class="font-semibold text-gray-900">{project.data.title}</h3>
                {project.data.description && (
                  <p class="mt-1 text-sm text-gray-600 line-clamp-2">{project.data.description}</p>
                )}
              </a>
            ))}
          </div>
        ) : (
          <p class="mt-6 text-sm text-gray-500">Projects coming soon.</p>
        )}
        <div class="mt-8">
          <Button href={GET_STARTED_PROJECTS.cta.href} variant="secondary" size="lg">
            {GET_STARTED_PROJECTS.cta.label}
          </Button>
        </div>
      </div>
    </section>

    {/* Resources */}
    <section class="bg-gray-50 py-16 sm:py-20">
      <div class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl">
          <p class="text-sm font-semibold uppercase tracking-wider text-zenml-500">
            {GET_STARTED_RESOURCES.eyebrow}
          </p>
          <h2 class="mt-2 text-2xl font-bold text-gray-900 sm:text-3xl">
            {GET_STARTED_RESOURCES.headline}
          </h2>
          <p class="mt-3 text-lg text-gray-600 leading-relaxed">
            {GET_STARTED_RESOURCES.body}
          </p>
        </div>
        <div class="mt-10 grid gap-6 sm:grid-cols-2">
          {GET_STARTED_RESOURCES.items.map((resource) => (
            <a
              href={resource.href}
              target={resource.external ? "_blank" : undefined}
              rel={resource.external ? "noopener noreferrer" : undefined}
              class="group rounded-md border border-gray-200 bg-white p-6 transition hover:shadow-md"
            >
              <div class:list={[
                "inline-flex h-10 w-10 items-center justify-center rounded-lg",
                resourceColors[resource.color],
              ]}>
                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
              </div>
              <h3 class="mt-4 text-lg font-semibold text-gray-900 group-hover:text-zenml-500">
                {resource.title}
              </h3>
              <p class="mt-2 text-sm text-gray-600 leading-relaxed">{resource.body}</p>
            </a>
          ))}
        </div>
      </div>
    </section>

    {/* Final CTA */}
    <FeaturesHubCTA
      headline={GET_STARTED_FINAL_CTA.headline}
      body={GET_STARTED_FINAL_CTA.body}
      primaryCta={GET_STARTED_FINAL_CTA.primaryCta}
      secondaryCta={GET_STARTED_FINAL_CTA.secondaryCta}
    />
  </main>
</BaseLayout>
