---
/**
 * IntegrationsMarquee â€” infinite horizontal scroll of integration logos.
 *
 * Fetches logos from the integrations content collection and renders
 * them in a CSS-animated marquee strip. The strip is duplicated for
 * seamless looping. Pauses on hover.
 */
import { getCollection } from "astro:content";
import { INTEGRATIONS_MARQUEE } from "../../lib/homepage";
import Button from "../Button.astro";

const integrations = await getCollection("integrations", ({ data }) => !data.draft);
const logos = integrations
  .filter((i) => i.data.logo?.url)
  .map((i) => ({ name: i.data.title, src: i.data.logo!.url }));
---

<section class="overflow-hidden bg-white py-16 sm:py-20">
  <div class="mx-auto max-w-7xl px-4 text-center sm:px-6 lg:px-8">
    <h2 class="text-3xl font-bold text-gray-900 sm:text-4xl">
      {INTEGRATIONS_MARQUEE.headline}
    </h2>
    <p class="mt-3 text-lg text-gray-600">{INTEGRATIONS_MARQUEE.subheadline}</p>
  </div>

  <!-- Marquee strip -->
  <div class="group relative mt-10">
    <!-- Fade edges -->
    <div class="pointer-events-none absolute inset-y-0 left-0 z-10 w-24 bg-gradient-to-r from-white to-transparent"></div>
    <div class="pointer-events-none absolute inset-y-0 right-0 z-10 w-24 bg-gradient-to-l from-white to-transparent"></div>

    <div class="flex animate-marquee gap-10 group-hover:[animation-play-state:paused]">
      {/* Render logos twice for seamless loop */}
      {[...logos, ...logos].map((logo) => (
        <div class="flex h-12 w-20 flex-shrink-0 items-center justify-center">
          <img
            src={logo.src}
            alt={logo.name}
            class="max-h-10 max-w-[5rem] object-contain opacity-60 grayscale transition hover:opacity-100 hover:grayscale-0"
            loading="lazy"
          />
        </div>
      ))}
    </div>
  </div>

  <!-- CTAs -->
  <div class="mt-10 flex flex-wrap justify-center gap-4">
    <Button href={INTEGRATIONS_MARQUEE.primaryCta.href} size="lg">
      {INTEGRATIONS_MARQUEE.primaryCta.label}
    </Button>
    <Button href={INTEGRATIONS_MARQUEE.secondaryCta.href} variant="secondary" size="lg">
      {INTEGRATIONS_MARQUEE.secondaryCta.label}
    </Button>
  </div>
</section>

<style>
  @keyframes marquee-slide {
    from { transform: translateX(0); }
    to { transform: translateX(-50%); }
  }
  .animate-marquee {
    animation: marquee-slide 60s linear infinite;
    width: max-content;
  }
  @media (prefers-reduced-motion: reduce) {
    .animate-marquee {
      animation: none;
    }
  }
</style>
