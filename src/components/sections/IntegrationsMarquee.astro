---
/**
 * IntegrationsMarquee â€” infinite horizontal scroll of integration logos.
 *
 * Fetches logos from the integrations content collection and renders
 * them in a CSS-animated marquee strip. The strip is duplicated for
 * seamless looping. Pauses on hover.
 */
import { getCollection } from "astro:content";
import { INTEGRATIONS_MARQUEE } from "../../lib/homepage";
import Button from "../Button.astro";

type LogoItem = {
  name: string;
  src: string;
  alt: string;
  href: string;
};

const integrations = await getCollection(
  "integrations",
  ({ data }) => !data.draft,
);
const logos: LogoItem[] = integrations.flatMap((i) => {
  const logo = i.data.logo;
  if (!logo?.url) {
    return [];
  }

  return [
    {
      name: i.data.title,
      src: logo.url,
      alt: logo.alt || i.data.title,
      href: `/integrations/${i.data.slug}`,
    },
  ];
});

const marqueeItems = [
  ...logos.map((logo) => ({ ...logo, isDuplicate: false })),
  ...logos.map((logo) => ({ ...logo, isDuplicate: true })),
];
---

<section class="relative overflow-hidden bg-white pt-16 pb-16 sm:pt-20 sm:pb-20">
  <div class="mx-auto max-w-7xl px-4 text-center sm:px-6 lg:px-8">
    <h2 class="text-3xl font-bold text-gray-900 sm:text-4xl">
      {INTEGRATIONS_MARQUEE.headline}
    </h2>
    <p class="mt-3 text-lg text-gray-600">{INTEGRATIONS_MARQUEE.subheadline}</p>
  </div>

  <!-- Marquee strip -->
  <div class="group relative mt-10">
    <!-- Fade edges -->
    <div class="pointer-events-none absolute inset-y-0 left-0 z-10 w-24 bg-gradient-to-r from-white to-transparent"></div>
    <div class="pointer-events-none absolute inset-y-0 right-0 z-10 w-24 bg-gradient-to-l from-white to-transparent"></div>

    <div
      class="flex animate-marquee gap-4 group-hover:[animation-play-state:paused] group-focus-within:[animation-play-state:paused]"
    >
      {/* Render logos twice for seamless loop */}
      {marqueeItems.map((logo) => (
        <a
          href={logo.href}
          class="flex h-[60px] w-[60px] flex-shrink-0 items-center justify-center rounded-lg border-2 border-gray-200 bg-white transition-all duration-200 hover:scale-[1.3] hover:border-zenml-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-zenml-500"
          aria-hidden={logo.isDuplicate ? "true" : undefined}
          tabindex={logo.isDuplicate ? -1 : undefined}
        >
          <img
            src={logo.src}
            alt={logo.alt}
            class="h-10 w-10 object-contain"
            width="40"
            height="40"
            loading="lazy"
          />
        </a>
      ))}
    </div>
  </div>

  <!-- CTAs -->
  <div class="mt-10 flex flex-wrap justify-center gap-4">
    <Button href={INTEGRATIONS_MARQUEE.primaryCta.href} size="lg">
      {INTEGRATIONS_MARQUEE.primaryCta.label}
    </Button>
    <Button href={INTEGRATIONS_MARQUEE.secondaryCta.href} variant="secondary" size="lg">
      {INTEGRATIONS_MARQUEE.secondaryCta.label}
    </Button>
  </div>

</section>

<style>
  @keyframes marquee-slide {
    from { transform: translateX(0); }
    to { transform: translateX(-50%); }
  }
  .animate-marquee {
    animation: marquee-slide 150s linear infinite;
    width: max-content;
  }
  @media (prefers-reduced-motion: reduce) {
    .animate-marquee {
      animation: none;
    }
  }
</style>
