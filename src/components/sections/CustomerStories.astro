---
/**
 * CustomerStories â€” case study cards + testimonial carousel.
 *
 * Combines CMS quotes (from the quotes collection) with extra
 * testimonials hardcoded in homepage.ts. Case study cards link
 * to individual case study pages.
 */
import { getCollection } from "astro:content";
import {
  CUSTOMER_STORIES_HEADER,
  CASE_STUDY_CARDS,
  EXTRA_TESTIMONIALS,
} from "../../lib/homepage";
import type { Testimonial } from "../../lib/homepage";

// Load CMS quotes and merge with hardcoded extras
const cmsQuotes = await getCollection("quotes");
const cmsTestimonials: Testimonial[] = cmsQuotes.map((q) => ({
  name: q.data.author,
  position: q.data.position,
  text: q.data.text,
  avatarUrl: q.data.avatar?.url,
  companyLogoUrl: q.data.companyLogo?.url,
}));

const allTestimonials = [...cmsTestimonials, ...EXTRA_TESTIMONIALS];
---

<section class="bg-white py-16 sm:py-24">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="text-center">
      <h2 class="text-3xl font-bold text-gray-900 sm:text-4xl">
        {CUSTOMER_STORIES_HEADER.headline}
      </h2>
      <p class="mt-3 text-lg text-gray-600">
        {CUSTOMER_STORIES_HEADER.subheadline}
      </p>
    </div>

    <!-- Case study cards -->
    <div class="mt-12 grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
      {CASE_STUDY_CARDS.map((card) => (
        <a
          href={card.href}
          class="group flex flex-col rounded-xl border border-gray-200 bg-white p-5 shadow-sm transition hover:shadow-md"
        >
          <div class="mb-4 flex items-center gap-3">
            <img
              src={card.companyLogo}
              alt={card.companyLogoAlt}
              class="h-6 w-auto"
              loading="lazy"
            />
            {card.secondaryLogo && (
              <img
                src={card.secondaryLogo}
                alt={card.secondaryLogoAlt}
                class="h-6 w-auto"
                loading="lazy"
              />
            )}
          </div>
          <p class="text-sm font-medium text-gray-900 group-hover:text-zenml-500 transition">
            {card.title}
          </p>
        </a>
      ))}
    </div>

    <!-- Testimonials grid -->
    <div class="mt-16 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      {allTestimonials.map((t) => (
        <div class="rounded-xl border border-gray-100 bg-gray-50 p-6">
          <blockquote class="text-sm leading-relaxed text-gray-700">
            &ldquo;{t.text}&rdquo;
          </blockquote>
          <div class="mt-4 flex items-center gap-3">
            {t.avatarUrl ? (
              <img
                src={t.avatarUrl}
                alt={t.name}
                class="h-10 w-10 rounded-full object-cover"
                loading="lazy"
              />
            ) : (
              <div class="flex h-10 w-10 items-center justify-center rounded-full bg-zenml-100 text-sm font-bold text-zenml-600">
                {t.name.split(" ").map((n) => n[0]).join("")}
              </div>
            )}
            <div>
              <p class="text-sm font-semibold text-gray-900">{t.name}</p>
              <p class="text-xs text-gray-500">{t.position}</p>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>
