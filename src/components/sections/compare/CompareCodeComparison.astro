---
/**
 * CompareCodeComparison — side-by-side code section.
 *
 * Dark background, 2-column grid on desktop, collapses to 1 column on tablet.
 * Each column has a sticky header with tool icon + label, then a code block.
 *
 * Uses Astro's built-in Code component for Shiki syntax highlighting.
 */
import { Code } from "astro:components";

interface Props {
  toolName: string;
  toolIcon?: { url: string; alt?: string };
  zenmlIconUrl: string;
  zenmlCode: string;
  toolCode: string;
  zenmlLanguage?: string;
  toolLanguage?: string;
  anchorId?: string;
}

const {
  toolName,
  toolIcon,
  zenmlIconUrl,
  zenmlCode,
  toolCode,
  zenmlLanguage = "python",
  toolLanguage = "python",
  anchorId = "code-comparison",
} = Astro.props;
---

<section id={anchorId} class="code-comparison-section bg-[#111827] py-16 sm:py-20">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-10 fade-in-element">
      <p class="text-sm font-semibold uppercase tracking-wider text-zenml-400 mb-3">Code comparison</p>
      <h2 class="text-3xl font-bold text-white sm:text-4xl">
        ZenML and {toolName} side by side
      </h2>
    </div>

    <div class="grid gap-8 lg:grid-cols-2">
      {/* ZenML column — sticky on desktop so short code stays visible */}
      <div class="fade-in-element lg:sticky lg:top-20 lg:self-start">
        <div class="flex items-center gap-4 py-4">
          <img src={zenmlIconUrl} alt="ZenML" width="28" height="28" class="rounded" />
          <span class="text-xl font-semibold text-white">ZenML</span>
        </div>
        <div class="code-comparison-block overflow-x-auto rounded-lg border border-gray-700/50 bg-[#0d1117]">
          <Code code={zenmlCode.trim()} lang={zenmlLanguage} theme="github-dark" />
        </div>
      </div>

      {/* Tool column */}
      <div class="fade-in-element">
        <div class="flex items-center gap-4 py-4">
          {toolIcon ? (
            <img src={toolIcon.url} alt={toolIcon.alt || toolName} width="28" height="28" class="rounded" />
          ) : (
            <div class="flex h-7 w-7 items-center justify-center rounded bg-gray-700 text-sm font-bold text-white">
              {toolName[0]}
            </div>
          )}
          <span class="text-xl font-semibold text-white">{toolName}</span>
        </div>
        <div class="code-comparison-block overflow-x-auto rounded-lg border border-gray-700/50 bg-[#0d1117]">
          <Code code={toolCode.trim()} lang={toolLanguage} theme="github-dark" />
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .code-comparison-block :global(pre) {
    margin: 0;
    padding: 1.25rem;
    background: transparent !important;
    border-radius: 0;
  }
  .code-comparison-block :global(code) {
    font-size: 0.85rem;
    line-height: 1.6;
  }

  /* Scroll-triggered fade-in animation */
  .fade-in-element {
    opacity: 0;
    transform: translateY(1rem);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }
  .fade-in-element.is-visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.1 }
  );
  document.querySelectorAll('.code-comparison-section .fade-in-element').forEach((el) => {
    observer.observe(el);
  });
</script>
