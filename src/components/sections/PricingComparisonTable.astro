---
/**
 * PricingComparisonTable — sectioned feature comparison with ✓/✗ icons.
 *
 * Unlike ComparisonTable.astro (plain text columns), this component supports:
 * - boolean values rendered as check/cross SVG icons
 * - section headers (grouping rows by category)
 * - CTA button row at the bottom
 * - Optional links on feature names
 *
 * Used on /pricing (both Self-Hosted and SaaS tabs).
 */
import type { PricingCompareTableData } from "../../lib/marketingPageTypes";
import Button from "../Button.astro";

interface Props {
  data: PricingCompareTableData;
}

const { data } = Astro.props;
const colCount = data.columnHeaders.length;
---

<div class="mt-12">
  <h3 class="mb-6 text-center text-2xl font-bold text-gray-900">Compare Plans</h3>
  <div class="overflow-x-auto">
    <table class="w-full min-w-[600px] border-collapse text-sm">
      {/* Column headers */}
      <thead>
        <tr class="border-b-2 border-gray-200">
          <th class="py-3 pr-4 text-left font-medium text-gray-500">Plans</th>
          {data.columnHeaders.map((header) => (
            <th class="px-4 py-3 text-center font-bold text-gray-900">{header}</th>
          ))}
        </tr>
      </thead>
      <tbody>
        {data.sections.map((section) => (
          <>
            {/* Section header row */}
            <tr>
              <td
                colspan={colCount + 1}
                class="bg-gray-50 px-0 py-2 text-xs font-bold uppercase tracking-wider text-gray-500"
              >
                {section.heading}
              </td>
            </tr>
            {/* Data rows */}
            {section.rows.map((row, rowIdx) => (
              <tr class:list={[
                "border-b border-gray-100",
                rowIdx % 2 === 1 ? "bg-gray-50/50" : "",
              ]}>
                <td class="py-3 pr-4 font-medium text-gray-900">
                  {row.link ? (
                    <a
                      href={row.link}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="text-zenml-500 hover:text-zenml-600"
                    >
                      {row.feature} ↗
                    </a>
                  ) : (
                    row.feature
                  )}
                </td>
                {row.values.map((val) => (
                  <td class="px-4 py-3 text-center">
                    {val === true ? (
                      <svg class="mx-auto h-5 w-5 text-zenml-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M20 6L9 17l-5-5" />
                      </svg>
                    ) : val === false ? (
                      <svg class="mx-auto h-5 w-5 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17 7L7 17M7 7l10 10" />
                      </svg>
                    ) : val === "COMING SOON" ? (
                      <span class="inline-block rounded bg-zenml-500 px-1.5 py-0.5 text-[10px] font-bold uppercase leading-tight text-white">
                        Coming Soon
                      </span>
                    ) : (
                      <span class="text-gray-700">{val}</span>
                    )}
                  </td>
                ))}
              </tr>
            ))}
          </>
        ))}
        {/* CTA button row */}
        <tr class="border-t-2 border-gray-200">
          <td></td>
          {data.ctaButtons.map((cta, i) => (
            <td class="px-4 py-4 text-center">
              <Button href={cta.href} size="sm" variant={i === 0 && colCount === 2 ? "secondary" : "primary"}>
                {cta.label}
              </Button>
            </td>
          ))}
        </tr>
      </tbody>
    </table>
  </div>
</div>
