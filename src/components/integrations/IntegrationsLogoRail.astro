---
import { getCollection } from "astro:content";

interface Props {
  excludeSlug?: string;
  limit?: number;
}

const { excludeSlug, limit } = Astro.props as Props;

type LogoRailItem = {
  name: string;
  src: string;
  alt: string;
  href: string;
  slug: string;
};

const integrations = await getCollection(
  "integrations",
  ({ data }) => !data.draft,
);

const logoItems: LogoRailItem[] = integrations
  .flatMap((integration) => {
    const logo = integration.data.logo;
    if (!logo?.url) {
      return [];
    }

    return [
      {
        name: integration.data.title,
        slug: integration.data.slug,
        src: logo.url,
        alt: logo.alt || integration.data.title,
        href: `/integrations/${integration.data.slug}`,
      },
    ];
  })
  .filter((item) => (excludeSlug ? item.slug !== excludeSlug : true))
  .sort((a, b) => a.name.localeCompare(b.name));

const itemsToRender =
  typeof limit === "number" ? logoItems.slice(0, limit) : logoItems;
---

{
  itemsToRender.length > 0 && (
    <div class="mt-6">
      <div class="overflow-x-auto pb-2 [scrollbar-width:thin]">
        <ul class="mx-auto flex w-max min-w-full items-center justify-center gap-3" aria-label="Other ZenML integrations">
          {itemsToRender.map((item) => (
            <li>
              <a
                href={item.href}
                class="flex h-[56px] w-[56px] flex-shrink-0 items-center justify-center rounded-lg border border-gray-600 bg-white p-2 transition-all duration-200 hover:-translate-y-0.5 hover:border-primary-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-400"
              >
                <img
                  src={item.src}
                  alt={item.alt}
                  class="h-8 w-8 object-contain"
                  width="32"
                  height="32"
                  loading="lazy"
                />
              </a>
            </li>
          ))}
        </ul>
      </div>
    </div>
  )
}
